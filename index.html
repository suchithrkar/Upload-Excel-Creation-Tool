<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>KCI Case Tracker ‚Äì Upload Excel Creation Tool</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- DataTables CSS -->
  <link rel="stylesheet" href="https://cdn.datatables.net/1.13.8/css/jquery.dataTables.min.css" />
  <link rel="stylesheet" href="https://cdn.datatables.net/fixedheader/3.4.0/css/fixedHeader.dataTables.min.css">

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

  <!-- Custom CSS -->
  <link rel="stylesheet" href="index.css" />
</head>
<body>
  <header class="app-header">
    <div class="header-inner">
      <div class="brand">
        <div class="brand-mark">KCI</div>
        <div>
          <h1>KCI Case Tracker</h1>
          <p>Upload Excel Creation Tool</p>
        </div>
      </div>
      <div class="header-actions">
        <button id="themeToggle" class="icon-button" title="Toggle theme">üåô</button>
      </div>
    </div>
  </header>

  <main class="app-shell">
    <section class="control-panel">
      <div class="panel-card">
        <div class="panel-heading">
          <div>
            <span class="eyebrow">Step 1</span>
            <h2>Upload source files</h2>
            <p>Provide the latest KCI, CSO, and tracking exports to generate your workbook.</p>
          </div>
          <div class="panel-badge">Required</div>
        </div>

        <div class="upload-grid">
          <div class="upload-field">
            <label for="kciInput">KCI ‚Äì Open Repair Case Data (Excel)</label>
            <input type="file" id="kciInput" accept=".xlsx" />
          </div>

          <div class="upload-field">
            <label for="csoInput">GNPro ‚Äì CSO Status File (CSV)</label>
            <input type="file" id="csoInput" accept=".csv" />
          </div>

          <div class="upload-field">
            <label for="trackingInput">Tracking Results File (CSV)</label>
            <input type="file" id="trackingInput" accept=".csv" />
          </div>
        </div>

        <div class="primary-action">
          <button id="processBtn" disabled>Process Excel</button>
          <span class="helper-text">Process one file at a time. The tool remembers previous uploads.</span>
        </div>
      </div>

      <div class="panel-card">
        <div class="panel-heading">
          <div>
            <span class="eyebrow">Step 2</span>
            <h2>Quick actions</h2>
            <p>Use the shortcuts below to manage outputs and support tables.</p>
          </div>
          <div class="panel-badge ghost">Tools</div>
        </div>

        <div class="action-grid">
          <button id="copySoBtn">Copy SO Orders</button>
          <button id="copyTrackingBtn">Copy Tracking URLs</button>
          <button id="sbdBtn">SBD Cut Off Times</button>
          <button id="tlBtn">TL</button>
          <button id="marketBtn">Market</button>
          <button id="processRepairBtn">Process Repair Data</button>
        </div>

        <div class="panel-note">
          <strong>Tip:</strong> Run ‚ÄúProcess Repair Data‚Äù after updating TL, Market, and SBD assignments.
        </div>
      </div>
    </section>

    <section class="data-panel">
      <div class="data-header">
        <div>
          <h2>Live sheets</h2>
          <p>Review, filter, and export the workbook tabs below.</p>
        </div>
        <div class="data-status">
          <span class="status-dot"></span>
          Ready for uploads
        </div>
      </div>
      <div id="tablesContainer" class="tables-surface"></div>
    </section>
  </main>

  <!-- Modals -->
  <div id="soModal" class="modal-overlay" style="display:none;">
    <div class="modal modal-polished modal-medium">
      <h3 id="soModalTitle">Copy SO Orders Preview</h3>
      <div class="so-modal-body">
        <div id="soCount" class="so-count"></div>
        <textarea id="soOutput" readonly></textarea>
      </div>
      <div class="modal-actions">
        <button id="copyToClipboardBtn">Copy to Clipboard</button>
        <button id="closeModalBtn">Close</button>
      </div>
    </div>
  </div>

  <div id="tlModal" class="modal-overlay" style="display:none;">
    <div class="modal modal-polished modal-medium">
      <h3>TL Assignment</h3>
      <div class="tl-market-scroll">
        <div id="tlContainer" class="mapping-grid"></div>
      </div>
      <button class="add-btn" id="addTlBtn">+ Add TL</button>
      <div class="modal-actions">
        <button id="saveTlBtn">Save</button>
        <button onclick="closeModal('tlModal')">Close</button>
      </div>
    </div>
  </div>

  <div id="marketModal" class="modal-overlay" style="display:none;">
    <div class="modal modal-polished modal-medium">
      <h3>Market Assignment</h3>
      <div class="tl-market-scroll">
        <div id="marketContainer" class="mapping-grid"></div>
      </div>
      <button class="add-btn" id="addMarketBtn">+ Add Market</button>
      <div class="modal-actions">
        <button id="saveMarketBtn">Save</button>
        <button onclick="closeModal('marketModal')">Close</button>
      </div>
    </div>
  </div>

  <div id="sbdModal" class="modal-overlay" style="display:none;">
    <div class="modal sbd-modal modal-polished modal-large">
      <h3>SBD Cut Off Times</h3>
      <div class="sbd-periods"></div>
      <div class="modal-actions">
        <button id="saveSbdBtn">Save</button>
        <button id="closeSbdBtn">Close</button>
      </div>
    </div>
  </div>

  <div id="progressOverlay" class="progress-overlay" style="display:none;">
    <div class="progress-card">
      <div id="overlayStatusText" class="overlay-status"></div>
      <div class="overlay-progress-bar">
        <div id="overlayProgressBar">
          <span id="overlayProgressText">0%</span>
        </div>
      </div>
      <button id="overlayConfirmBtn" class="overlay-confirm" style="display:none;">OK</button>
    </div>
  </div>

  <!-- Libraries -->
  <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
  <script src="https://cdn.datatables.net/1.13.8/js/jquery.dataTables.min.js"></script>
  <script src="https://cdn.datatables.net/fixedheader/3.4.0/js/dataTables.fixedHeader.min.js"></script>

  <!-- App JS -->
  <script src="index.js"></script>
</body>
</html>
